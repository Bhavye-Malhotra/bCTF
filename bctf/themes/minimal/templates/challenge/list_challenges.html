{% extends 'templates/base.html' %}
{% load static %}

{% block extra_js%}
    <script src="{{theme_static}}/js/jquery.form.js"></script>
{% endblock %}

{% block content %}
    <!-- Typography -->
    <div class="grid">
        <div class="cell -12of12">
            <h1><i class="fas fa-flag-checkered"></i> Challenges</h1>
        </div>
    </div>
 <div class="grid">
     <div class="cell -7of12">
            <div class="content">
            {% for category in categories %}
                <h1>{{category}}</h1>
                {% for challenge in challenges %}
                    {% if challenge.category == category and challenge.visible == True %}
                            {% if challenge.pk in solved_by_user %}
                            <a  value="{{challenge}}"
                                class="btn btn-success btn-ghost btn-challenge"
                                href="#{{challenge.name}}"
                                data-toggle="modal"
                                data-target="#challengeModals"
                                data-challenge-id="{{challenge.pk}}"
                                >
                                <i class="fas fa-check"></i>
                            {% else %}
                            <a  value="{{challenge}}" 
                                class="btn btn-primary btn-ghost btn-challenge"
                                href="#{{challenge.name}}"
                                data-toggle="modal"
                                data-target="#challengeModals"
                                data-challenge-id="{{challenge.pk}}"
                                >
                                <i class="fas fa-crosshairs"></i>
                            {% endif %}
                                {{challenge.name}}<br />{{challenge.points}}
                            </a>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </div>
     </div>
     <div class="cell -4of12">
         <div class="content">
            <div id="challengeCard">

            </div>
        </div>
     </div>
 </div>


{% endblock %}

{% block custom_javascript %}

<script>
    $('document').ready(function() {
    
        $('.btn-challenge').on('click', function (event) {
            var modal = $("#challengeCard")
            modal.show();
            modal.html("Loading...")
            var challengeID = $(this).data('challenge-id')
            console.log(challengeID)
            var formURL = `/challenges/${challengeID}/flag/`
            $.ajax({
                url: formURL,
                context: document.body
            }).done(function(response) {
                modal.html(response);
            }).fail(function(err){
                if (err.status == 403) {
                    modal.html(`
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                CTF Ended
                            </div>
                            <div class="modal-body">
                                Be faster next year!
                            </div>
                        </div>
                    </div>
                    `)
                }
            });
        })

    });
</script>
{% endblock %}